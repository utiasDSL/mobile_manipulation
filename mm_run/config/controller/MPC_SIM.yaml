# MPC Controller configuration for simulation
# Extends MPC.yaml with simulation-specific settings

include:
  - package: "mm_run"
    path: "config/controller/MPC.yaml"

controller:
  # Simulation-specific overrides
  ctrl_rate: 20  # Higher rate for simulation (20 Hz vs 10 Hz for real robot)

  # Disable collision avoidance for simpler simulation
  self_collision_avoidance_enabled: False
  sdf_collision_avoidance_enabled: False
  static_obstacles_collision_avoidance_enabled: False

  # Simplified collision constraint type (scalar instead of per-type dict)
  collision_constraint_type: "SignedDistanceConstraint"

  # Enable soft constraints for SDF and static obstacles in simulation
  collision_constraints_softend:
    sdf: True
    static_obstacles: True

  # Smaller safety margin for SDF in simulation
  collision_safety_margin:
    sdf: 0.15

  # Simplified CBF gamma (scalar instead of per-type dict)
  collision_cbf_gamma: 0.9

  # Simplified cost params (scalars instead of arrays for simulation)
  cost_params:
    EEPos3:
      Qk: 10.0
      P: 1.0
    EEPos3BaseFrame:
      Qk: 3
      P: 1
    BasePos2:
      Qk: 10.0
      P: 1.0
    BasePos3:
      Qk: 10.0
      P: 1.0
    BasePoseSE2:
      Qk: 10.0
      P: 1.0
    EEVel3:
      Qk: 5.0
      P: 1.0
    BaseVel2:
      Qk: 5.0
      P: 1.0
    BaseVel3:
      Qk: 5.0
      P: 1.0
    Effort:
      Qqa: 0.0
      Qqb: 0.0
      Qva: 0.01
      Qvb: 0.01
      Qua: 0.005
      Qub: 0.005
      Qdua: 0.0
      Qdub: 0.1
    slack:
      z: 100  # Higher slack penalty for simulation

  # ACADOS solver options for simulation
  acados:
    ocp_solver_options:
      nlp_solver_type: "SQP"  # Use SQP instead of SQP_RTI for simulation
      nlp_solver_tol_stat: 1.0e-04  # Tighter tolerance
    slack_enabled:
      u: True  # Enable slack for control inputs in simulation
      h_e: False  # Disable slack for terminal constraints
